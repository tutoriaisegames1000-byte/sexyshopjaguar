<script>
const area=document.getElementById("categorias");
const carrinhoFlutuante=document.getElementById("carrinho-flutuante");
const contador=document.getElementById("contador");

let carrinho=[];
let carrinhoAberto=false;

/* MODAL DO CARRINHO */
const modal=document.createElement("div");
modal.id="modal-carrinho";
modal.style.cssText=`
position:fixed;
bottom:90px;
right:20px;
background:#111;
padding:14px;
border-radius:14px;
width:260px;
display:none;
flex-direction:column;
gap:8px;
z-index:1000;
`;
document.body.appendChild(modal);

/* FECHAR */
const fechar=document.createElement("div");
fechar.innerHTML="✕";
fechar.style.cssText=`
position:absolute;
top:-12px;
right:-12px;
background:red;
color:#fff;
width:28px;
height:28px;
border-radius:50%;
display:flex;
align-items:center;
justify-content:center;
cursor:pointer;
`;
fechar.onclick=()=>{
  modal.style.display="none";
  carrinhoAberto=false;
};
modal.appendChild(fechar);

/* BOTÃO FINALIZAR */
const finalizar=document.createElement("button");
finalizar.textContent="Finalizar Compra";
finalizar.style.cssText=`
background:#FFD700;
border:none;
border-radius:12px;
padding:10px;
font-weight:bold;
cursor:pointer;
`;
finalizar.onclick=()=>{
  const msg=encodeURIComponent(
    "Olá, gostaria de adquirir esses produtos: "+carrinho.join(", ")
  );
  window.open("https://wa.me/5573998443608?text="+msg,"_blank");
};

/* RENDERIZA PRODUTOS */
dados.forEach(cat=>{
  const div=document.createElement("div");
  div.className="categoria";
  div.innerHTML=`<h2>${cat.titulo}</h2><div class="linha"></div><div class="carrossel"></div>`;
  const car=div.querySelector(".carrossel");
  area.appendChild(div);

  cat.itens.forEach(nome=>{
    const prod=document.createElement("div");
    prod.className="produto";
    prod.innerHTML=`
      <div class="imagem-produto" onclick="abrirZoom('${cat.pasta}/${nome}.jpg')">
        <img src="${cat.pasta}/${nome}.jpg" loading="lazy">
      </div>
      <div class="produto-info">
        <button class="btn-produto">COMPRAR</button>
      </div>
    `;
    car.appendChild(prod);

    const btn=prod.querySelector(".btn-produto");

    btn.onclick=()=>{
      const i=carrinho.indexOf(nome);
      if(i===-1){
        carrinho.push(nome);
        btn.style.background="var(--amarelo)";
        btn.textContent="CARRINHO";
        carrinhoFlutuante.classList.add("pop");
        setTimeout(()=>carrinhoFlutuante.classList.remove("pop"),200);
      }else{
        carrinho.splice(i,1);
        btn.style.background="#25D366";
        btn.textContent="COMPRAR";
      }
      atualizarCarrinho();
    };
  });
});

/* ATUALIZA CARRINHO */
function atualizarCarrinho(){
  if(carrinho.length){
    carrinhoFlutuante.style.display="flex";
    contador.textContent=carrinho.length;
  }else{
    carrinhoFlutuante.style.display="none";
    modal.style.display="none";
    carrinhoAberto=false;
  }
}

/* ABRE / FECHA MODAL */
carrinhoFlutuante.onclick=()=>{
  if(!carrinhoAberto){
    modal.innerHTML="";
    modal.appendChild(fechar);
    carrinho.forEach(p=>{
      const item=document.createElement("p");
      item.textContent="• "+p;
      modal.appendChild(item);
    });
    modal.appendChild(finalizar);
    modal.style.display="flex";
    carrinhoAberto=true;
  }else{
    modal.style.display="none";
    carrinhoAberto=false;
  }
};

/* ZOOM */
function abrirZoom(src){
  zoomImg.src=src;
  zoom.style.display="flex";
}
function fecharZoom(){
  zoom.style.display="none";
}
</script>
